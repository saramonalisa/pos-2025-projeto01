{% extends 'base.html' %}

{% block title %}Boletim - {{ user.nome_usual }}{% endblock %}

{% block content %}
<div class="w-100 mx-auto" style="max-width: 1000px;">
  <h2 class="mb-4">Boletim - Período {{ selected_periodo }}</h2>

  <form method="POST" class="mb-4">
    <label for="periodo" class="form-label">Selecione o período:</label>
    <select name="periodo" id="periodo" class="form-select d-inline w-auto" onchange="this.form.submit()">
      {% for p in periodos %}
        {% set periodo_value = p.ano_letivo ~ '.' ~ p.periodo_letivo %}
        <option value="{{ periodo_value }}" {% if periodo_value == selected_periodo %}selected{% endif %}>
          {{ periodo_value }}
        </option>
      {% endfor %}
    </select>
  </form>

  <div class="table-responsive-md">
    <table class="table table-sm table-bordered table-striped align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th rowspan="2">Disciplina</th>
          <th colspan="2">Etapa 1</th>
          <th colspan="2">Etapa 2</th>
          <th colspan="2">Etapa 3</th>
          <th colspan="2">Etapa 4</th>
          <th colspan="2">Aval. Final</th>
          <th rowspan="2">Média Final</th>
          <th rowspan="2">Faltas</th>
          <th rowspan="2">% Frequência</th>
          <th rowspan="2">Situação</th>
        </tr>
        <tr>
          <th>Nota</th><th>Faltas</th>
          <th>Nota</th><th>Faltas</th>
          <th>Nota</th><th>Faltas</th>
          <th>Nota</th><th>Faltas</th>
          <th>Nota</th><th>Faltas</th>
        </tr>
      </thead>
      <tbody>
        {% for data in boletim_data %}
        {% set situacao = data.situacao.lower() %}
        {% set situacao_class =
          'table-success' if 'aprovado' in situacao else
          'table-danger' if 'reprovado' in situacao
        %}
        <tr>
          <td class="text-start">{{ data.disciplina }}</td>

          <td>{{ data.nota_etapa_1.nota if data.nota_etapa_1.nota not in [None, 0] else '—' }}</td>
          <td>{{ data.nota_etapa_1.faltas if data.nota_etapa_1.faltas is not none else '—' }}</td>

          <td>{{ data.nota_etapa_2.nota if data.nota_etapa_2.nota not in [None, 0] else '—' }}</td>
          <td>{{ data.nota_etapa_2.faltas if data.nota_etapa_2.faltas is not none else '—' }}</td>

          <td>{{ data.nota_etapa_3.nota if data.nota_etapa_3.nota not in [None, 0] else '—' }}</td>
          <td>{{ data.nota_etapa_3.faltas if data.nota_etapa_3.faltas is not none else '—' }}</td>

          <td>{{ data.nota_etapa_4.nota if data.nota_etapa_4.nota not in [None, 0] else '—' }}</td>
          <td>{{ data.nota_etapa_4.faltas if data.nota_etapa_4.faltas is not none else '—' }}</td>

          <td>{{ data.nota_avaliacao_final.nota if data.nota_avaliacao_final.nota not in [None, 0] else '—' }}</td>
          <td>{{ data.nota_avaliacao_final.faltas if data.nota_avaliacao_final.faltas is not none else '—' }}</td>

          <td>{{ data.media_final_disciplina if data.media_final_disciplina else '—' }}</td>
          <td>{{ data.numero_faltas }}</td>
          <td>{{ data.percentual_carga_horaria_frequentada }}%</td>
          <td class="{{ situacao_class }} fw-bold">{{ data.situacao }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
